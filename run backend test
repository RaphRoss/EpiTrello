Run npm test

> epitrello-backend@1.0.0 test
> jest --verbose --coverage

  console.error
    Upload error: Error: Write error
        at Object.<anonymous> (/home/runner/work/EpiTrello/EpiTrello/backend/routes/__tests__/uploads.test.js:71:15)
        at /home/runner/work/EpiTrello/EpiTrello/backend/node_modules/jest-mock/build/index.js:397:39
        at Object.<anonymous> (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/jest-mock/build/index.js:404:13)
        at Object.mockConstructor (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/jest-mock/build/index.js:148:19)
        at Object.writeFileSync (eval at _createMockFunction (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/jest-mock/build/index.js:566:31), <anonymous>:3:59)
        at writeFileSync (/home/runner/work/EpiTrello/EpiTrello/backend/routes/uploads.js:29:12)
        at Layer.handle [as handle_request] (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/express/lib/router/layer.js:95:5)
        at next (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/express/lib/router/route.js:149:13)
        at Route.dispatch (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/express/lib/router/route.js:119:3)
        at Layer.handle [as handle_request] (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/express/lib/router/layer.js:95:5)
        at /home/runner/work/EpiTrello/EpiTrello/backend/node_modules/express/lib/router/index.js:284:15
        at Function.process_params (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/express/lib/router/index.js:346:12)
        at next (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/express/lib/router/index.js:280:10)
        at Function.handle (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/express/lib/router/index.js:175:3)
        at router (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/express/lib/router/index.js:47:12)
        at Layer.handle [as handle_request] (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/express/lib/router/index.js:328:13)
        at /home/runner/work/EpiTrello/EpiTrello/backend/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/express/lib/router/index.js:346:12)
        at next (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/express/lib/router/index.js:280:10)
        at /home/runner/work/EpiTrello/EpiTrello/backend/node_modules/body-parser/lib/read.js:137:5
        at AsyncResource.runInAsyncScope (node:async_hooks:203:9)
        at invokeCallback (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/raw-body/index.js:238:16)
        at done (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/raw-body/index.js:227:7)
        at IncomingMessage.onEnd (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/raw-body/index.js:287:7)
        at IncomingMessage.emit (node:events:517:28)
        at endReadableNT (node:internal/streams/readable:1400:12)
        at processTicksAndRejections (node:internal/process/task_queues:82:21)

      36 |         });
      37 |     } catch (error) {
    > 38 |         console.error('Upload error:', error);
         |                 ^
      39 |         res.status(500).json({ error: 'Failed to upload file' });
      40 |     }
      41 | });

      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

  console.error
    Error fetching comments: Error: Database error
        at Object.<anonymous> (/home/runner/work/EpiTrello/EpiTrello/backend/routes/__tests__/comments.test.js:55:42)
        at Promise.then.completed (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/jest-circus/build/run.js:121:9)
        at run (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/home/runner/work/EpiTrello/EpiTrello/backend/node_modules/jest-runner/build/testWorker.js:106:12)

      16 |         res.json(result.rows);
      17 |     } catch (error) {
    > 18 |         console.error('Error fetching comments:', error);
         |                 ^
      19 |         res.status(500).json({ error: 'Failed to fetch comments' });
      20 |     }
      21 | });

      at error (routes/comments.js:18:17)

PASS routes/__tests__/uploads.test.js
  Uploads API Routes
    POST /api/uploads/upload
      ✓ should upload a file successfully (66 ms)
      ✓ should return 400 if required fields are missing (6 ms)
      ✓ should sanitize file names (5 ms)
      ✓ should handle upload errors (62 ms)
    GET /api/uploads/download/:fileName
      ✓ should return 404 for non-existent file (8 ms)
    DELETE /api/uploads/:fileName
      ✓ should delete an existing file (3 ms)
      ✓ should return 204 even if file does not exist (idempotent) (4 ms)
      ✓ should handle deletion errors (33 ms)
    File Security
      ✓ should generate unique file names (19 ms)

PASS routes/__tests__/comments.test.js
  Comments API
    GET /api/comments/card/:cardId
      ✓ should get all comments for a card (47 ms)
      ✓ should handle database errors (41 ms)
    POST /api/comments
      ✓ should create a new comment (15 ms)
      ✓ should create comment without userId (3 ms)
    PUT /api/comments/:id
      ✓ should update a comment (5 ms)
      ✓ should return 404 if comment not found (4 ms)
    DELETE /api/comments/:id
      ✓ should delete a comment (4 ms)
      ✓ should return 404 if comment not found (3 ms)

  console.error
    Registration error: error: password authentication failed for user "postgres"
        at /home/runner/work/EpiTrello/EpiTrello/backend/node_modules/pg-pool/index.js:45:11
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at /home/runner/work/EpiTrello/EpiTrello/backend/routes/auth.js:26:30 {
      length: 104,
      severity: 'FATAL',
      code: '28P01',
      detail: undefined,
      hint: undefined,
      position: undefined,
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'auth.c',
      line: '334',
      routine: 'auth_failed'
    }

      51 |         });
      52 |     } catch (error) {
    > 53 |         console.error('Registration error:', error);
         |                 ^
      54 |         res.status(500).json({ error: 'Failed to register user' });
      55 |     }
      56 | });

      at error (routes/auth.js:53:17)

  console.error
    Registration error: error: password authentication failed for user "postgres"
        at /home/runner/work/EpiTrello/EpiTrello/backend/node_modules/pg-pool/index.js:45:11
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at /home/runner/work/EpiTrello/EpiTrello/backend/routes/auth.js:26:30 {
      length: 104,
      severity: 'FATAL',
      code: '28P01',
      detail: undefined,
      hint: undefined,
      position: undefined,
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'auth.c',
      line: '334',
      routine: 'auth_failed'
    }

      51 |         });
      52 |     } catch (error) {
    > 53 |         console.error('Registration error:', error);
         |                 ^
      54 |         res.status(500).json({ error: 'Failed to register user' });
      55 |     }
      56 | });

      at error (routes/auth.js:53:17)

  console.error
    Registration error: error: password authentication failed for user "postgres"
        at /home/runner/work/EpiTrello/EpiTrello/backend/node_modules/pg-pool/index.js:45:11
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at /home/runner/work/EpiTrello/EpiTrello/backend/routes/auth.js:26:30 {
      length: 104,
      severity: 'FATAL',
      code: '28P01',
      detail: undefined,
      hint: undefined,
      position: undefined,
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'auth.c',
      line: '334',
      routine: 'auth_failed'
    }

      51 |         });
      52 |     } catch (error) {
    > 53 |         console.error('Registration error:', error);
         |                 ^
      54 |         res.status(500).json({ error: 'Failed to register user' });
      55 |     }
      56 | });

      at error (routes/auth.js:53:17)

  console.error
    Login error: error: password authentication failed for user "postgres"
        at /home/runner/work/EpiTrello/EpiTrello/backend/node_modules/pg-pool/index.js:45:11
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at /home/runner/work/EpiTrello/EpiTrello/backend/routes/auth.js:67:24 {
      length: 104,
      severity: 'FATAL',
      code: '28P01',
      detail: undefined,
      hint: undefined,
      position: undefined,
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'auth.c',
      line: '334',
      routine: 'auth_failed'
    }

      87 |         });
      88 |     } catch (error) {
    > 89 |         console.error('Login error:', error);
         |                 ^
      90 |         res.status(500).json({ error: 'Failed to login' });
      91 |     }
      92 | });

      at error (routes/auth.js:89:17)

  console.error
    Login error: error: password authentication failed for user "postgres"
        at /home/runner/work/EpiTrello/EpiTrello/backend/node_modules/pg-pool/index.js:45:11
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at /home/runner/work/EpiTrello/EpiTrello/backend/routes/auth.js:67:24 {
      length: 104,
      severity: 'FATAL',
      code: '28P01',
      detail: undefined,
      hint: undefined,
      position: undefined,
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'auth.c',
      line: '334',
      routine: 'auth_failed'
    }

      87 |         });
      88 |     } catch (error) {
    > 89 |         console.error('Login error:', error);
         |                 ^
      90 |         res.status(500).json({ error: 'Failed to login' });
      91 |     }
      92 | });

      at error (routes/auth.js:89:17)

  console.error
    Login error: error: password authentication failed for user "postgres"
        at /home/runner/work/EpiTrello/EpiTrello/backend/node_modules/pg-pool/index.js:45:11
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at /home/runner/work/EpiTrello/EpiTrello/backend/routes/auth.js:67:24 {
      length: 104,
      severity: 'FATAL',
      code: '28P01',
      detail: undefined,
      hint: undefined,
      position: undefined,
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'auth.c',
      line: '334',
      routine: 'auth_failed'
    }

      87 |         });
      88 |     } catch (error) {
    > 89 |         console.error('Login error:', error);
         |                 ^
      90 |         res.status(500).json({ error: 'Failed to login' });
      91 |     }
      92 | });

      at error (routes/auth.js:89:17)

  console.error
    Auth error: error: password authentication failed for user "postgres"
        at /home/runner/work/EpiTrello/EpiTrello/backend/node_modules/pg-pool/index.js:45:11
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at /home/runner/work/EpiTrello/EpiTrello/backend/routes/auth.js:105:24 {
      length: 104,
      severity: 'FATAL',
      code: '28P01',
      detail: undefined,
      hint: undefined,
      position: undefined,
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'auth.c',
      line: '334',
      routine: 'auth_failed'
    }

      120 |         });
      121 |     } catch (error) {
    > 122 |         console.error('Auth error:', error);
          |                 ^
      123 |         res.status(500).json({ error: 'Failed to authenticate' });
      124 |     }
      125 | });

      at error (routes/auth.js:122:17)

  console.error
    Auth error: error: password authentication failed for user "postgres"
        at /home/runner/work/EpiTrello/EpiTrello/backend/node_modules/pg-pool/index.js:45:11
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at /home/runner/work/EpiTrello/EpiTrello/backend/routes/auth.js:105:24 {
      length: 104,
      severity: 'FATAL',
      code: '28P01',
      detail: undefined,
      hint: undefined,
      position: undefined,
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'auth.c',
      line: '334',
      routine: 'auth_failed'
    }

      120 |         });
      121 |     } catch (error) {
    > 122 |         console.error('Auth error:', error);
          |                 ^
      123 |         res.status(500).json({ error: 'Failed to authenticate' });
      124 |     }
      125 | });

      at error (routes/auth.js:122:17)

  console.error
    Registration error: error: password authentication failed for user "postgres"
        at /home/runner/work/EpiTrello/EpiTrello/backend/node_modules/pg-pool/index.js:45:11
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at /home/runner/work/EpiTrello/EpiTrello/backend/routes/auth.js:26:30 {
      length: 104,
      severity: 'FATAL',
      code: '28P01',
      detail: undefined,
      hint: undefined,
      position: undefined,
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'auth.c',
      line: '334',
      routine: 'auth_failed'
    }

      51 |         });
      52 |     } catch (error) {
    > 53 |         console.error('Registration error:', error);
         |                 ^
      54 |         res.status(500).json({ error: 'Failed to register user' });
      55 |     }
      56 | });

      at error (routes/auth.js:53:17)

  console.error
    Registration error: error: password authentication failed for user "postgres"
        at /home/runner/work/EpiTrello/EpiTrello/backend/node_modules/pg-pool/index.js:45:11
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at /home/runner/work/EpiTrello/EpiTrello/backend/routes/auth.js:26:30 {
      length: 104,
      severity: 'FATAL',
      code: '28P01',
      detail: undefined,
      hint: undefined,
      position: undefined,
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'auth.c',
      line: '334',
      routine: 'auth_failed'
    }

      51 |         });
      52 |     } catch (error) {
    > 53 |         console.error('Registration error:', error);
         |                 ^
      54 |         res.status(500).json({ error: 'Failed to register user' });
      55 |     }
      56 | });

      at error (routes/auth.js:53:17)

FAIL routes/__tests__/auth.test.js
  Auth API Routes
    POST /api/auth/register
      ✕ should register a new user successfully (82 ms)
      ✓ should return 400 if required fields are missing (6 ms)
      ✕ should return 409 if user already exists (12 ms)
      ✓ should handle file write errors (12 ms)
    POST /api/auth/login
      ✕ should login successfully with valid credentials (13 ms)
      ✓ should return 400 if required fields are missing (4 ms)
      ✕ should return 401 with invalid email (8 ms)
      ✕ should return 401 with invalid password (9 ms)
    GET /api/auth/me
      ✕ should return user info with valid token (9 ms)
      ✓ should return 401 if no token provided (3 ms)
      ✕ should return 401 if token is invalid (8 ms)
    Security
      ✕ should hash passwords before storing (9 ms)
      ✕ should not return password in response (10 ms)

  ● Auth API Routes › POST /api/auth/register › should register a new user successfully

    expected 201 "Created", got 500 "Internal Server Error"

      37 |         .post('/api/auth/register')
      38 |         .send(newUser)
    > 39 |         .expect(201);
         |          ^
      40 |
      41 |       expect(response.body).toHaveProperty('user');
      42 |       expect(response.body).toHaveProperty('token');

      at Object.expect (routes/__tests__/auth.test.js:39:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Auth API Routes › POST /api/auth/register › should return 409 if user already exists

    expected 409 "Conflict", got 500 "Internal Server Error"

      73 |           password: 'password123'
      74 |         })
    > 75 |         .expect(409);
         |          ^
      76 |
      77 |       expect(response.body).toHaveProperty('error', 'User already exists');
      78 |     });

      at Object.expect (routes/__tests__/auth.test.js:75:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Auth API Routes › POST /api/auth/login › should login successfully with valid credentials

    expected 200 "OK", got 500 "Internal Server Error"

      115 |           password: 'password'
      116 |         })
    > 117 |         .expect(200);
          |          ^
      118 |
      119 |       expect(response.body).toHaveProperty('user');
      120 |       expect(response.body).toHaveProperty('token');

      at Object.expect (routes/__tests__/auth.test.js:117:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Auth API Routes › POST /api/auth/login › should return 401 with invalid email

    expected 401 "Unauthorized", got 500 "Internal Server Error"

      139 |           password: 'password'
      140 |         })
    > 141 |         .expect(401);
          |          ^
      142 |
      143 |       expect(response.body).toHaveProperty('error', 'Invalid credentials');
      144 |     });

      at Object.expect (routes/__tests__/auth.test.js:141:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Auth API Routes › POST /api/auth/login › should return 401 with invalid password

    expected 401 "Unauthorized", got 500 "Internal Server Error"

      151 |           password: 'wrongpassword'
      152 |         })
    > 153 |         .expect(401);
          |          ^
      154 |
      155 |       expect(response.body).toHaveProperty('error', 'Invalid credentials');
      156 |     });

      at Object.expect (routes/__tests__/auth.test.js:153:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Auth API Routes › GET /api/auth/me › should return user info with valid token

    expected 200 "OK", got 500 "Internal Server Error"

      175 |         .get('/api/auth/me')
      176 |         .set('Authorization', `***
    > 177 |         .expect(200);
          |          ^
      178 |
      179 |       expect(response.body).toHaveProperty('username', 'testuser');
      180 |       expect(response.body).toHaveProperty('email', 'test@example.com');

      at Object.expect (routes/__tests__/auth.test.js:177:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Auth API Routes › GET /api/auth/me › should return 401 if token is invalid

    expected 401 "Unauthorized", got 500 "Internal Server Error"

      194 |         .get('/api/auth/me')
      195 |         .set('Authorization', '***')
    > 196 |         .expect(401);
          |          ^
      197 |
      198 |       expect(response.body).toHaveProperty('error', 'Invalid token');
      199 |     });

      at Object.expect (routes/__tests__/auth.test.js:196:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Auth API Routes › Security › should hash passwords before storing

    expected 201 "Created", got 500 "Internal Server Error"

      211 |         .post('/api/auth/register')
      212 |         .send(newUser)
    > 213 |         .expect(201);
          |          ^
      214 |
      215 |       const writeCall = fs.writeFileSync.mock.calls[0];
      216 |       const savedData = JSON.parse(writeCall[1]);

      at Object.expect (routes/__tests__/auth.test.js:213:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Auth API Routes › Security › should not return password in response

    expected 201 "Created", got 500 "Internal Server Error"

      229 |           password: 'password123'
      230 |         })
    > 231 |         .expect(201);
          |          ^
      232 |
      233 |       expect(response.body.user).not.toHaveProperty('password');
      234 |     });

      at Object.expect (routes/__tests__/auth.test.js:231:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

----------------|---------|----------|---------|---------|--------------------------
File            | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s        
----------------|---------|----------|---------|---------|--------------------------
All files       |   60.57 |    56.94 |   71.42 |   60.57 |                          
 backend        |   10.41 |    33.33 |       0 |   10.41 |                          
  db.js         |   10.41 |    33.33 |       0 |   10.41 | 16-178                   
 backend/routes |   79.52 |     73.8 |   83.33 |   79.52 |                          
  auth.js       |    65.3 |    57.89 |      60 |    65.3 | 8,13,31-44,72-80,110-116 
  comments.js   |      85 |    91.66 |     100 |      85 | 50-51,71-72,87-88        
  uploads.js    |    92.1 |    81.81 |     100 |    92.1 | 52-55                    
----------------|---------|----------|---------|---------|--------------------------
Test Suites: 1 failed, 2 passed, 3 total
Tests:       9 failed, 21 passed, 30 total
Snapshots:   0 total
Time:        1.683 s
Ran all test suites.
Error: Process completed with exit code 1.